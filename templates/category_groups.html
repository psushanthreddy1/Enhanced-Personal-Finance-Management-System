<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Transaction Categories</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    body {
      background: #111;
      color: white;
      font-family: Arial;
      margin: 0;
    }

    /* ‚úÖ Sidebar */
    .sidebar {
      width: 260px;
      height: 100vh;
      background: black;
      position: fixed;
      padding: 20px;
    }

    .sidebar h3 {
      font-weight: bold;
      margin-bottom: 30px;
    }

    .sidebar p {
      font-size: 12px;
      color: gray;
      margin-top: 25px;
    }

    .sidebar a {
      display: block;
      padding: 12px;
      margin: 6px 0;
      color: white;
      text-decoration: none;
      border-radius: 10px;
      font-size: 15px;
    }

    .sidebar a:hover {
      background: orange;
      color: black;
    }

    /* ‚úÖ Main Content */
    .content {
      margin-left: 280px;
      padding: 25px;
    }

    /* ‚úÖ Layout for Target Panel */
    .category-layout {
      display: flex;
      gap: 20px;
    }

    .category-list {
      flex: 2;
    }

    .target-panel {
      flex: 1;
      background: #1a1a1a;
      border-radius: 14px;
      padding: 20px;
      min-height: 250px;
      height: fit-content;
    }

    .target-placeholder {
      color: gray;
      font-size: 14px;
    }

    /* ‚úÖ Top Bar */
    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
    }

    .date-text {
      color: #4da3ff;
      font-size: 22px;
      font-weight: bold;
      cursor: pointer;
      user-select: none;
    }

    /* ‚úÖ Group Card */
    .group-card {
      background: #1a1a1a;
      border-radius: 14px;
      margin-bottom: 25px;
      padding: 10px;
    }

    .group-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-weight: bold;
      padding: 12px;
      font-size: 17px;
    }

    /* ‚úÖ Category Row */
    .category {
      padding: 12px 14px;
      border-top: 1px solid #2a2a2a;
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
    }

    .category:hover {
      background: #222;
    }

    /* ‚úÖ Delete Button */
    .delete-btn {
      background: transparent;
      border: 1px solid #666;
      color: white;
      width: 24px;
      height: 24px;
      border-radius: 5px;
      cursor: pointer;
    }

    .delete-btn:hover {
      background: red;
    }

    /* ‚úÖ Modal */
    .modal-content {
      background: #1b1b1b;
      color: white;
      border-radius: 12px;
    }

    .modal input,
    .modal select {
      background: #111;
      border: 1px solid #444;
      color: white;
    }
  </style>
</head>

<body>

<!-- ‚úÖ Sidebar -->
<div class="sidebar">
  <h3>Money Map</h3>

  <a href="/">üè† Overview</a>

  <p>TRANSACTION DATA</p>
  <a href="/transactions">üìÑ Transaction Details</a>
  <a href="/analysis">üìä Statistics & Analysis</a>

  <p>BASIS DATA</p>
  <a href="/accounts">üè¶ Accounts</a>
  <a href="/categories">üìÇ Transaction Categories</a>
  <a href="/budget">üí∞ Budget Planner</a>
  <a href="/alerts">üö® Alerts</a>
</div>

<!-- ‚úÖ Main Content -->
<div class="content category-layout">

  <!-- ‚úÖ LEFT SIDE -->
  <div class="category-list">

    <!-- ‚úÖ Date + Add Button -->
    <div class="top-bar">
      <div class="date-text" onclick="openDatePicker()">
        <span id="dateLabel"></span> ‚ñæ
      </div>

      <!-- Hidden Date Picker -->
      <input type="date" id="datePicker" hidden onchange="updateDate(this.value)">

      <button class="btn btn-warning fw-bold" onclick="openTransactionModal()">
        ‚ûï Add
      </button>
    </div>

    <!-- ‚úÖ Bills -->
    <div class="group-card">
      <div class="group-header"><span>‚ñæ Bills</span></div>
      <div id="billsList">
        <div class="category" onclick="showTarget('Utilities')">
          ‚ö° Utilities
          <button class="delete-btn"
            onclick="event.stopPropagation(); this.parentElement.remove();">√ó</button>
        </div>

        <div class="category" onclick="showTarget('Recharge')">
          üíª Recharge
          <button class="delete-btn"
            onclick="event.stopPropagation(); this.parentElement.remove();">√ó</button>
        </div>
      </div>
    </div>

    <!-- ‚úÖ Needs -->
    <div class="group-card">
      <div class="group-header"><span>‚ñæ Needs</span></div>
      <div id="needsList">
        <div class="category" onclick="showTarget('Groceries')">
          üõí Groceries
          <button class="delete-btn"
            onclick="event.stopPropagation(); this.parentElement.remove();">√ó</button>
        </div>

        <div class="category" onclick="showTarget('Transportation')">
          üöå Transportation
          <button class="delete-btn"
            onclick="event.stopPropagation(); this.parentElement.remove();">√ó</button>
        </div>
      </div>
    </div>

    <!-- ‚úÖ Wants -->
    <div class="group-card">
      <div class="group-header"><span>‚ñæ Wants</span></div>
      <div id="wantsList">
        <div class="category" onclick="showTarget('Shopping')">
          üõç Shopping
          <button class="delete-btn"
            onclick="event.stopPropagation(); this.parentElement.remove();">√ó</button>
        </div>

        <div class="category" onclick="showTarget('Travel')">
          ‚úà Travel
          <button class="delete-btn"
            onclick="event.stopPropagation(); this.parentElement.remove();">√ó</button>
        </div>
      </div>
    </div>

  </div>

  <!-- ‚úÖ RIGHT SIDE TARGET PANEL -->
  <div class="target-panel">
    <h4 id="targetTitle">Select a Category</h4>
    <hr style="border-color:#333;">

    <div id="targetInfo">
      <p class="target-placeholder">
        Click on any category to view Target details here.
      </p>
    </div>

    <button class="btn btn-primary mt-3" id="targetBtn" style="display:none;">
      Create Target
    </button>
  </div>

</div>

<!-- ‚úÖ Transaction Modal -->
<div class="modal fade" id="txnModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content p-3">
      <h5>Add Transaction</h5>

      <input id="txnText" class="form-control my-2" placeholder="Enter text (ex: food)">
      <input id="txnAmount" type="number" class="form-control my-2" placeholder="Amount">

      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button class="btn btn-primary" onclick="saveTransaction()">Add</button>
      </div>
    </div>
  </div>
</div>

<!-- ‚úÖ Target Modal -->
<div class="modal fade" id="targetModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content p-4">

      <h4 id="targetCategoryTitle">Target</h4>
      <hr style="border-color:#333;">

      <!-- Tabs -->
      <div class="btn-group w-100 mb-3" id="targetTabs">
        <button class="btn btn-outline-light active" onclick="selectPlan('Weekly',this)">Weekly</button>
        <button class="btn btn-outline-light" onclick="selectPlan('Monthly',this)">Monthly</button>
        <button class="btn btn-outline-light" onclick="selectPlan('Yearly',this)">Yearly</button>
        <button class="btn btn-outline-light" onclick="selectPlan('Custom',this)">Custom</button>
      </div>

      <!-- ‚úÖ Dynamic Fields -->
      <div id="dynamicFields"></div>

      <!-- Buttons -->
      <div class="d-flex justify-content-between mt-4">
        <button class="btn btn-danger" onclick="deleteTarget()">Delete</button>
        <div>
          <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button class="btn btn-primary" onclick="saveTarget()">Save Target</button>
        </div>
      </div>

    </div>
  </div>
</div>

<!-- Bootstrap -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
  const txnModal = new bootstrap.Modal(document.getElementById("txnModal"));
  const targetModal = new bootstrap.Modal(document.getElementById("targetModal"));

  let selectedCategory = "";
  let selectedPlan = "Weekly";

  // ‚úÖ Permanent Storage Category Wise
  let targets = JSON.parse(localStorage.getItem("targets")) || {};
  let transactions = JSON.parse(localStorage.getItem("transactions")) || {};
  let assignedAmounts = JSON.parse(localStorage.getItem("assignedAmounts")) || {};

  // ‚úÖ Auto Date
  window.onload = function () {
    const today = new Date().toISOString().split("T")[0];
    document.getElementById("datePicker").value = today;
    updateDate(today);
    loadFields();
    loadSavedTransactions();
  };
  
  function assignMoney(categoryName) {

  let target = parseFloat(targets[categoryName].amount);

  // if not assigned yet
  if (!assignedAmounts[categoryName]) {
    assignedAmounts[categoryName] = 0;
  }

  // Add money step by step
  let add = prompt("Enter amount to assign:");

  if (add === null || add === "") return;

  add = parseFloat(add);

  assignedAmounts[categoryName] += add;

  // Save permanently
  localStorage.setItem("assignedAmounts", JSON.stringify(assignedAmounts));

  // Refresh UI
  showTarget(categoryName);
}

  function loadSavedTransactions() {

  Object.keys(transactions).forEach(cat => {

    transactions[cat].forEach(txn => {

      let categoryBox = document.getElementById("wantsList");

      if (txn.name.includes("food") || txn.name.includes("grocery"))
        categoryBox = document.getElementById("needsList");

      if (txn.name.includes("travel"))
        categoryBox = document.getElementById("wantsList");

      if (txn.name.includes("bill") || txn.name.includes("utility") || txn.name.includes("recharge"))
        categoryBox = document.getElementById("billsList");

      const row = document.createElement("div");
      row.className = "category";

      row.innerHTML = `
        üí∞ ${txn.name} - ‚Çπ${txn.amount}
        <button class="delete-btn"
          onclick="event.stopPropagation(); this.parentElement.remove();">
          √ó
        </button>
      `;

      categoryBox.appendChild(row);

    });

  });
}

  function openDatePicker() {
    document.getElementById("datePicker").showPicker();
  }

  function updateDate(value) {
    const dateObj = new Date(value);
    document.getElementById("dateLabel").innerText =
      dateObj.toLocaleDateString("en-US", {
        year: "numeric",
        month: "short",
        day: "2-digit"
      });
  }

  // ‚úÖ Add Transaction Working
  function openTransactionModal() {
    txnModal.show();
  }

function saveTransaction() {

  const text = document.getElementById("txnText").value.toLowerCase();
  const amount = document.getElementById("txnAmount").value;

  if (text === "" || amount === "") {
    alert("Enter transaction details");
    return;
  }

  let categoryBox = document.getElementById("wantsList");

  if (text.includes("food") || text.includes("grocery"))
    categoryBox = document.getElementById("needsList");

  if (text.includes("travel"))
    categoryBox = document.getElementById("wantsList");

  if (text.includes("bill") || text.includes("utility") || text.includes("recharge"))
    categoryBox = document.getElementById("billsList");

  // ‚úÖ Create Transaction Row
  const row = document.createElement("div");
  row.className = "category";

  // ‚úÖ NEW: This added entry becomes a real category name
  let newCategoryName = text.charAt(0).toUpperCase() + text.slice(1);

  // ‚úÖ NEW: Make it work like existing category click
  

  row.innerHTML = `
    üí∞ ${newCategoryName} - ‚Çπ${amount}
    <button class="delete-btn"
      onclick="event.stopPropagation(); this.parentElement.remove();">
      √ó
    </button>
  `;

  // ‚úÖ Add Into Correct Group
  categoryBox.appendChild(row);

  // ‚úÖ Clear Fields
  document.getElementById("txnText").value = "";
  document.getElementById("txnAmount").value = "";

  // ‚úÖ Close Modal
  txnModal.hide();
}


  // ‚úÖ Show Target Panel Category Wise
 // ‚úÖ Show Target Panel Category Wise
function showTarget(categoryName) {

  selectedCategory = categoryName;
  document.getElementById("targetTitle").innerText = categoryName;

  if (targets[categoryName]) {

    let t = targets[categoryName];

    // ‚úÖ Step 5 Percent Calculation (Correct Place)
    let assigned = assignedAmounts[categoryName] || 0;
    let percent = Math.min((assigned / t.amount) * 100, 100).toFixed(0);

    let color = "#ff4d4d"; // red default

if (percent >= 80) {
  color = "#28a745"; // green
} else if (percent >= 40) {
  color = "#ffc107"; // yellow
}


    let remaining = t.amount - assigned;
    if (remaining < 0) remaining = 0;

    document.getElementById("targetInfo").innerHTML = `
      <h5>Target</h5>
      <p><b>Set Aside ‚Çπ${t.amount} Each ${t.plan}</b></p>

      <!-- ‚úÖ Dynamic Percent Circle -->
      <div style="
  width:110px;
  height:110px;
  border-radius:50%;
  display:flex;
  justify-content:center;
  align-items:center;
  margin:20px auto;
  font-weight:bold;
  font-size:18px;
  background:conic-gradient(${color} ${percent}%, #333 ${percent}%);
">
  <div style="
    width:80px;
    height:80px;
    background:#111;
    border-radius:50%;
    display:flex;
    justify-content:center;
    align-items:center;
  ">
    ${percent}%
  </div>
</div>


      <!-- ‚úÖ Assign Button -->
      <div onclick="assignMoney('${categoryName}')"
      style="
      background:#f5e7a1;
      padding:12px;
      border-radius:12px;
      text-align:center;
      color:black;
      font-weight:bold;
      cursor:pointer;
      ">
        Assign ‚Çπ${remaining} to meet your target
      </div>

      <hr style="border-color:#333;">

      <p>
  <b>Assigned So Far:</b> ‚Çπ${assigned}
  <button onclick="editAssigned('${categoryName}')"
    style="margin-left:10px;
           background:#444;
           border:none;
           color:white;
           padding:4px 8px;
           border-radius:6px;
           cursor:pointer;">
    Edit
  </button>

  <button onclick="resetAssigned('${categoryName}')"
    style="margin-left:5px;
           background:#aa3333;
           border:none;
           color:white;
           padding:4px 8px;
           border-radius:6px;
           cursor:pointer;">
    Reset
  </button>
</p>

<p><b>To Go:</b> ‚Çπ${remaining}</p>


      <button class="btn btn-outline-primary w-100 mt-3"
      onclick="editTarget()">Edit Target</button>
    `;

    document.getElementById("targetBtn").style.display = "none";
    return;
  }

  // ‚úÖ Default message
  document.getElementById("targetInfo").innerHTML = `
    <b>Target</b><br><br>
    How much do you need for <b>${categoryName}</b>?<br>
    Create a target to stay on track over time.
  `;

  document.getElementById("targetBtn").style.display = "block";
}


  // ‚úÖ Open Target Modal
  document.getElementById("targetBtn").onclick = function () {
    document.getElementById("targetCategoryTitle").innerText =
      selectedCategory + " Target";
    loadFields();
    targetModal.show();
  };

  // ‚úÖ Plan Switch
  function selectPlan(plan, btn) {
    selectedPlan = plan;

    document.querySelectorAll("#targetTabs button")
      .forEach(b => b.classList.remove("active"));

    btn.classList.add("active");

    loadFields();
  }

  // ‚úÖ Correct Fields Like Screenshot
  function loadFields() {
    let html = "";

    if (selectedPlan === "Weekly") {
      html = `
        <label>I need</label>
        <input id="targetAmount" class="form-control my-2" placeholder="‚Çπ1000">

        <label>Every</label>
        <select class="form-control my-2">
          <option>Saturday</option>
          <option>Sunday</option>
          <option>Monday</option>
        </select>

        <label>Next month I want to</label>
        <select class="form-control my-2">
          <option>Set aside another ‚Çπ1000/week</option>
        </select>
      `;
    }

    if (selectedPlan === "Monthly") {
      html = `
        <label>I need</label>
        <input id="targetAmount" class="form-control my-2" placeholder="‚Çπ1000">

        <label>By</label>
        <select class="form-control my-2">
          <option>Last Day of Month</option>
          <option>15th of Month</option>
        </select>

        <label>Next month I want to</label>
        <select class="form-control my-2">
          <option>Set aside another ‚Çπ1000/month</option>
        </select>
      `;
    }

    if (selectedPlan === "Yearly") {
      html = `
        <label>I need</label>
        <input id="targetAmount" class="form-control my-2" placeholder="‚Çπ1000">

        <label>By</label>
        <input type="date" class="form-control my-2">

        <label>Next year I want to</label>
        <select class="form-control my-2">
          <option>Set aside another ‚Çπ1000/year</option>
        </select>
      `;
    }

    if (selectedPlan === "Custom") {
      html = `
        <label>Amount</label>
        <input id="targetAmount" class="form-control my-2" placeholder="‚Çπ1000">

        <label>Due on</label>
        <input type="date" class="form-control my-2">

        <label>Repeat</label>
        <select class="form-control my-2">
          <option>Every 1 Month</option>
          <option>Every 2 Months</option>
        </select>
      `;
    }

    document.getElementById("dynamicFields").innerHTML = html;
  }

  // ‚úÖ Save Target Permanently
  function saveTarget() {
    const amount = document.getElementById("targetAmount").value;

    if (amount === "") {
      alert("Enter amount");
      return;
    }

    targets[selectedCategory] = {
      amount: amount.replace("‚Çπ", ""),
      plan: selectedPlan
    };
    localStorage.setItem("targets", JSON.stringify(targets));


    targetModal.hide();
    showTarget(selectedCategory);
  }

  function editTarget() {
    loadFields();
    document.getElementById("targetAmount").value =
      targets[selectedCategory].amount;
    targetModal.show();
  }

  function deleteTarget() {
    delete targets[selectedCategory];
    localStorage.setItem("targets", JSON.stringify(targets));
    targetModal.hide();
    showTarget(selectedCategory);
  }
  
  function editAssigned(categoryName) {

  let current = assignedAmounts[categoryName] || 0;

  let newAmount = prompt("Edit assigned amount:", current);

  if (newAmount === null) return;

  newAmount = parseFloat(newAmount);

  if (isNaN(newAmount) || newAmount < 0) {
    alert("Enter valid amount");
    return;
  }

  assignedAmounts[categoryName] = newAmount;

  localStorage.setItem("assignedAmounts", JSON.stringify(assignedAmounts));

  showTarget(categoryName);
}

function resetAssigned(categoryName) {

  if (!confirm("Reset assigned amount?")) return;

  assignedAmounts[categoryName] = 0;

  localStorage.setItem("assignedAmounts", JSON.stringify(assignedAmounts));

  showTarget(categoryName);
}

</script>

</body>
</html> 